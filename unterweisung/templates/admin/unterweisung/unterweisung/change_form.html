{% extends 'django_object_actions/change_form.html' %}
{% load static %}

{% block admin_change_form_document_ready %}
{{ block.super }}
<script>
(function($) {
    $(document).ready(function() {
        /*  Listen for legacy jQuery events triggered by `django-polymorphic`
            and trigger corresponding native event

            issue: https://github.com/django-polymorphic/django-polymorphic/issues/546
        */

        $(document).on('formset:added', function(event, row, prefix) {
            if (!row) return;
            row.get(0).dispatchEvent(new CustomEvent('formset:added', {
                bubbles: true,
                detail: {
                    formsetName: prefix,
                },
            }));
        });
    });
})(django.jQuery || jQuery);
</script>
{% endblock %}
