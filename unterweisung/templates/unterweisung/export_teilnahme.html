{% extends "abfrage/base.html" %}
{% load mathfilters %}

{% block title %}Überweisungsübersicht{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
 <ol class="breadcrumb">
  <li class="breadcrumb-item"><a href="{% url "unterweisung:start" %}">Unterweisungen</a></li>
  <li class="breadcrumb-item active" aria-current="page">Übersicht</li>
 </ol>
</nav>

{% if quantiles %}
<div class="progress">
  <div class="progress-bar" role="progressbar" style="width: {% widthratio teilnahmen_done teilnahmen_total 100 %}%" aria-valuenow="{{ teilnahmen_done }}" aria-valuemin="0" aria-valuemax="{{ teilnahmen_total }}"></div>
</div>
<p>Teilnahmen erledigt: <strong>{{ teilnahmen_done }}</strong>, Teilnahmen offen: <strong>{{ teilnahmen_open }}</strong>, Teilnahmen insgesamt: {{ teilnahmen_total }}.</p>
{% else %}
<p>Mit der Unterschrift bestätige ich, die Unterweisung alleine bearbeitet und vollständig
 verstanden zu haben.</p>
{% endif %}

<table class="table table-striped">
<thead>
 <tr>
  <th scope="col">Helfer*in</th>
  {% for unterweisung in unterweisungen %}
  <th scope="col">{{ unterweisung.short_label }}</th>
  {% endfor %}
  {% if not quantiles %}
  <th scope="col" style="min-width:10em;">Unterschrift</th>
  {% endif %}
 </tr>
</thead>
<tbody>
 {% for username, data in personen %}
 <tr>
  <th scope="row">
   {% if data.namen|length > 0 %}{{ data.namen|join:" / " }}{% else %}{{ username }}{% endif %}
  </th>
  {% for teilnahme in data.teilnahmen %}
  <td>
   {% if teilnahme.1 is False %}
    <span class="badge bg-danger">Offen</span>
   {% elif teilnahme.1 is None %}
    <em>-</em>
   {% else %}
    {{ teilnahme.1|linebreaksbr }}
   {% endif %}
   {% if quantiles and teilnahme.2 %}
    <br />
    {% widthratio teilnahme.2 60 1 as duration_minutes %}
    <em>{{ duration_minutes|floatformat:1 }}min</em>
   {% endif %}
  </td>
  {% endfor %}
  {% if not quantiles %}
  <td>&nbsp;</td>
  {% endif %}
 </tr>
 {% endfor %}
</tbody>
{% if quantiles %}
<tfoot>
 <tr>
  <th scope="row">Median-Dauer</th>
  {% for quantile in quantiles %}
  <td>
   {% if quantile is None %}
    <em>-</em>
   {% else %}
    {% widthratio quantile.median 60 1 as median_minutes %}
    {{ median_minutes|floatformat:1 }}min
   {% endif %}
  </td>
  {% endfor %}
 </tr>
</tfoot>
{% endif %}
</table>

<style type="text/css">
@media print {
	h1 {display:none;}
	nav {display:none;}
}
</style>
{% endblock %}
